{"version":3,"sources":["../../src/dashboard/dashboard.service.ts"],"sourcesContent":["import { Injectable, NotFoundException, BadRequestException } from '@nestjs/common';\nimport { PrismaService } from '../prisma/prisma.service';\n\n@Injectable()\nexport class DashboardService {\n  constructor(private prisma: PrismaService) {}\n\n  async getDashboardData(userId: string) {\n    // Get user info\n    const user = await this.prisma.users.findUnique({\n      where: { user_id: userId }\n    });\n\n    if (!user) {\n      return { message: 'User not found' };\n    }\n    \n    // Basic welcome message\n    return {\n      message: `Welcome to your Servicio dashboard`,\n      userName: user.username\n    };\n  }\n\n  async getUserProfile(userId: string) {\n    const user = await this.prisma.users.findUnique({\n      where: { user_id: userId }\n    });\n\n    if (!user) {\n      throw new NotFoundException('User not found');\n    }\n\n    // Return user profile data\n    return {\n      id: user.user_id,\n      username: user.username,\n      email: user.email,\n      preferredLanguage: user.preferred_language,\n      profilePhotoUrl: user.profile_photo_url\n    };\n  }\n\n  async updateUserProfile(userId: string, updateData: any) {\n    // Verify user exists\n    const existingUser = await this.prisma.users.findUnique({\n      where: { user_id: userId }\n    });\n\n    if (!existingUser) {\n      throw new NotFoundException('User not found');\n    }\n\n    // Check if username already exists (if username is being updated)\n    if (updateData.username && updateData.username !== existingUser.username) {\n      const usernameExists = await this.prisma.users.findFirst({\n        where: {\n          username: {\n            equals: updateData.username,\n            mode: 'insensitive'\n          },\n          user_id: {\n            not: userId\n          }\n        }\n      });\n\n      if (usernameExists) {\n        throw new BadRequestException('Username already taken');\n      }\n    }\n\n    // Update user profile\n    try {\n      const updatedUser = await this.prisma.users.update({\n        where: { user_id: userId },\n        data: {\n          username: updateData.username,\n          preferred_language: updateData.preferredLanguage,\n          profile_photo_url: updateData.profilePhotoUrl\n        }\n      });\n\n      return {\n        id: updatedUser.user_id,\n        username: updatedUser.username,\n        email: updatedUser.email,\n        preferredLanguage: updatedUser.preferred_language,\n        profilePhotoUrl: updatedUser.profile_photo_url\n      };\n    } catch (error) {\n      throw new BadRequestException('Failed to update profile: ' + error.message);\n    }\n  }\n} "],"names":["DashboardService","getDashboardData","userId","user","prisma","users","findUnique","where","user_id","message","userName","username","getUserProfile","NotFoundException","id","email","preferredLanguage","preferred_language","profilePhotoUrl","profile_photo_url","updateUserProfile","updateData","existingUser","usernameExists","findFirst","equals","mode","not","BadRequestException","updatedUser","update","data","error","constructor"],"mappings":";;;;+BAIaA;;;eAAAA;;;wBAJsD;+BACrC;;;;;;;;;;AAGvB,IAAA,AAAMA,mBAAN,MAAMA;IAGX,MAAMC,iBAAiBC,MAAc,EAAE;QACrC,gBAAgB;QAChB,MAAMC,OAAO,MAAM,IAAI,CAACC,MAAM,CAACC,KAAK,CAACC,UAAU,CAAC;YAC9CC,OAAO;gBAAEC,SAASN;YAAO;QAC3B;QAEA,IAAI,CAACC,MAAM;YACT,OAAO;gBAAEM,SAAS;YAAiB;QACrC;QAEA,wBAAwB;QACxB,OAAO;YACLA,SAAS,CAAC,kCAAkC,CAAC;YAC7CC,UAAUP,KAAKQ,QAAQ;QACzB;IACF;IAEA,MAAMC,eAAeV,MAAc,EAAE;QACnC,MAAMC,OAAO,MAAM,IAAI,CAACC,MAAM,CAACC,KAAK,CAACC,UAAU,CAAC;YAC9CC,OAAO;gBAAEC,SAASN;YAAO;QAC3B;QAEA,IAAI,CAACC,MAAM;YACT,MAAM,IAAIU,yBAAiB,CAAC;QAC9B;QAEA,2BAA2B;QAC3B,OAAO;YACLC,IAAIX,KAAKK,OAAO;YAChBG,UAAUR,KAAKQ,QAAQ;YACvBI,OAAOZ,KAAKY,KAAK;YACjBC,mBAAmBb,KAAKc,kBAAkB;YAC1CC,iBAAiBf,KAAKgB,iBAAiB;QACzC;IACF;IAEA,MAAMC,kBAAkBlB,MAAc,EAAEmB,UAAe,EAAE;QACvD,qBAAqB;QACrB,MAAMC,eAAe,MAAM,IAAI,CAAClB,MAAM,CAACC,KAAK,CAACC,UAAU,CAAC;YACtDC,OAAO;gBAAEC,SAASN;YAAO;QAC3B;QAEA,IAAI,CAACoB,cAAc;YACjB,MAAM,IAAIT,yBAAiB,CAAC;QAC9B;QAEA,kEAAkE;QAClE,IAAIQ,WAAWV,QAAQ,IAAIU,WAAWV,QAAQ,KAAKW,aAAaX,QAAQ,EAAE;YACxE,MAAMY,iBAAiB,MAAM,IAAI,CAACnB,MAAM,CAACC,KAAK,CAACmB,SAAS,CAAC;gBACvDjB,OAAO;oBACLI,UAAU;wBACRc,QAAQJ,WAAWV,QAAQ;wBAC3Be,MAAM;oBACR;oBACAlB,SAAS;wBACPmB,KAAKzB;oBACP;gBACF;YACF;YAEA,IAAIqB,gBAAgB;gBAClB,MAAM,IAAIK,2BAAmB,CAAC;YAChC;QACF;QAEA,sBAAsB;QACtB,IAAI;YACF,MAAMC,cAAc,MAAM,IAAI,CAACzB,MAAM,CAACC,KAAK,CAACyB,MAAM,CAAC;gBACjDvB,OAAO;oBAAEC,SAASN;gBAAO;gBACzB6B,MAAM;oBACJpB,UAAUU,WAAWV,QAAQ;oBAC7BM,oBAAoBI,WAAWL,iBAAiB;oBAChDG,mBAAmBE,WAAWH,eAAe;gBAC/C;YACF;YAEA,OAAO;gBACLJ,IAAIe,YAAYrB,OAAO;gBACvBG,UAAUkB,YAAYlB,QAAQ;gBAC9BI,OAAOc,YAAYd,KAAK;gBACxBC,mBAAmBa,YAAYZ,kBAAkB;gBACjDC,iBAAiBW,YAAYV,iBAAiB;YAChD;QACF,EAAE,OAAOa,OAAO;YACd,MAAM,IAAIJ,2BAAmB,CAAC,+BAA+BI,MAAMvB,OAAO;QAC5E;IACF;IAxFAwB,YAAY,AAAQ7B,MAAqB,CAAE;aAAvBA,SAAAA;IAAwB;AAyF9C"}